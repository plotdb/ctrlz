(function(){var t,r;t="undefined"!=typeof window&&null!==window&&null!=window.json0?window.json0:require("json0"),(r=function(t){return null==t&&(t={}),this.cur=t.obj||{},this.stack={all:[],undo:[],redo:[]},this}).prototype=function(t,r){var s={}.hasOwnProperty;for(var n in r)s.call(r,n)&&(t[n]=r[n]);return t}(Object.create(Object.prototype),{get:function(){return this.cur},clear:function(){var t=this;return["all","undo","redo"].map(function(r){return t.stack[r].splice(0)})},reset:function(t){var r;return r=t.obj,this.cur=r,this.clear()},update:function(t,r){return null==r&&(r=!0),this.apply({obj:t,src:r})},apply:function(r){var s,n,o,i;return s=r.obj,n=r.op,o=r.src,o=null==o||o,!n&&s&&(n=t.diff(this.cur,s)),n.length?(i={op:n,src:o},this.stack.all.push(i),o&&(this.stack.redo.splice(0),this.stack.undo.push(i)),this.cur=t.type.apply(this.cur,n),{obj:this.cur,op:n}):{obj:this.cur,op:null}},undo:function(){var r,s,n,o,i,u;if(!(r=this.stack.undo.pop()))return{obj:this.cur,op:null};for(s=this.stack.all.indexOf(r),n=t.type.invert(r.op),o=s+1,i=this.stack.all.length;o<i;++o)u=o,this.stack.all[u].src||(n=t.type.transform(n,this.stack.all[u].op,"left"));return this.cur=t.type.apply(this.cur,n),r={op:n,src:!0},this.stack.all.push(r),this.stack.redo.push(r),{obj:this.cur,op:n}},redo:function(){var r,s,n,o,i,u;if(!(r=this.stack.redo.pop()))return{obj:this.cur,op:null};for(s=this.stack.all.indexOf(r),n=t.type.invert(r.op),o=s+1,i=this.stack.all.length;o<i;++o)u=o,this.stack.all[u].src||(n=t.type.transform(n,this.stack.all[u].op,"left"));return this.cur=t.type.apply(this.cur,n),r={op:n,src:!0},this.stack.all.push(r),this.stack.undo.push(r),{obj:this.cur,op:n}}}),"undefined"!=typeof module&&null!==module&&(module.exports=r),"undefined"!=typeof window&&null!==window&&(window.ctrlz=r)}).call(this);
