var otJson0,json0OtDiff,diffMatchPatch,jsonstate;otJson0=require("ot-json0");json0OtDiff=require("json0-ot-diff");diffMatchPatch=require("diff-match-patch");jsonstate=function(opt){opt==null&&(opt={});this.cur=opt.obj||{};this.idx=0;this.stack=[];return this};jsonstate.prototype=import$(Object.create(Object.prototype),{clear:function(){this.idx=0;return this.stack.splice(0)},reset:function(arg$){var obj;obj=arg$.obj;return this.cur=obj,this.idx=0,this.stack=[],this},update:function(obj){return this.apply({obj:obj})},apply:function(arg$){var obj,op;obj=arg$.obj,op=arg$.op;if(!op&&obj){op=json0OtDiff(this.cur,obj,diffMatchPatch)}if(this.idx<this.stack.length-1){this.stack.splice(this.idx)}this.stack.push(op);console.log(this.cur,op);this.cur=otJson0.type.apply(this.cur,op);this.idx=this.stack.length-1;return this.cur},undo:function(){var op;if(this.idx===-1){return this.cur}op=this.stack[this.idx];this.cur=otJson0.type.apply(this.cur,otJson0.type.invert(op));this.idx--;return this.cur},redo:function(){var op;if(this.idx>=this.stack.length-1){return this.cur}this.idx++;op=this.stack[this.idx];this.cur=otJson0.type.apply(this.cur,op);return this.cur}});if(typeof module!="undefined"&&module!==null){module.exports=jsonstate}if(typeof window!="undefined"&&window!==null){window.jsonstate=jsonstate}function import$(obj,src){var own={}.hasOwnProperty;for(var key in src)if(own.call(src,key))obj[key]=src[key];return obj}
