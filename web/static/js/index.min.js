!function(){var t,e,n,o,r,d,c,u,s,a;t={tomd:function(t){return t.str||""},tojson:function(t){return{str:t}}},e=function(t){if(n.doc&&t)return n.doc.submitOp(t)},window.otJson0=require("ot-json0"),n={json:{},text:""},o=require("md-2-json"),r=new ctrlz,d=new ldView({root:document.body,handler:{view:function(t){var e;return e=t.node,e.innerHTML=marked(n.text)},json:function(t){var e;return e=t.node,e.innerText=JSON.stringify(n.json,null,4)}},action:{click:{undo:function(o){var c,u,s,a;return o.node,c=r.undo(),u=c.obj,s=c.op,n.json=a=u,n.text=t.tomd(a),d.get("text").value=n.text,d.render(),e(s)},redo:function(o){var c,u,s;return o.node,c=r.redo(),u=c.obj,s=c.op,n.json=u,n.text=t.tomd(n.json),d.get("text").value=n.text,d.render(),e(s)}},input:{text:function(o){var c,u,s,a,i;c=o.node;try{u=t.tojson(n.text=c.value||"")}catch(t){return s=t,void console.log(s)}return a=r.update(n.json=u),a.obj,i=a.op,e(i),d.render()}}}});try{c=o.parse(n.text=d.get("text").value||""),r.update(n.json=c),d.render()}catch(t){u=t}try{if(s=new sharedbWrapper({url:{scheme:"http",domain:"localhost:3005"}}),a=function(){},!/share.html/.exec(window.location.href))return;s.get({id:"ctrlz-v3",watch:a}).then(function(e){return console.log("sharedb doc prepared: ",e),console.log(t.tojson(n.text)),n.doc=e,a(),n.json=JSON.parse(JSON.stringify(n.doc.data)),n.text=t.tomd(n.json),d.get("text").value=n.text,d.render(),r.reset({obj:n.json}),e.on("op",function(e,o){return o||r.apply({op:e,src:!1}),n.json=r.get(),n.text=t.tomd(n.json),d.get("text").value=n.text,d.render()})})}catch(t){u=t,console.log(u),console.log("conenct to sharedb server failed. run in standalone mode. ")}window.lc=n}();